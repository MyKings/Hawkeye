"use strict";(self["webpackChunkHawkeye"]=self["webpackChunkHawkeye"]||[]).push([[964],{6964:function(t,e,s){s.r(e),s.d(e,{default:function(){return c}});var i=function(){var t=this,e=t._self._c;return e("div",{staticClass:"notice-setting"},[e("el-row",{staticClass:"dashboard",attrs:{gutter:10}},[e("el-col",{attrs:{xs:24,sm:12,md:12,lg:4,xl:4}},[e("el-card",{attrs:{shadow:"hover"}},[e("div",{style:t.styles.dataItem,on:{click:function(e){t.MailDialogFormVisible=!0}}},[e("i",{staticClass:"iconfont icon-mail",style:t.styles.dataItemImg}),e("div",{style:t.styles.dataItemUnit},[e("div",{style:t.styles.unitAmount},[t._v("邮件")]),e("div",{style:t.styles.unitFooter},[t._v("状态："),e("span",{style:t.smtp_server.enabled?"color:#52c41a":"color:#f5222d"},[t._v(t._s(t.smtp_server.enabled?"开启":"关闭"))])])])])])],1),t._l(t.webhooks,(function(s){return e("el-col",{attrs:{xs:24,sm:12,md:12,lg:4,xl:4}},[e("el-card",{attrs:{shadow:"hover"}},[e("i",{staticClass:"iconfont icon-trash",staticStyle:{float:"right",color:"#868898"},on:{click:function(e){return t.delWebHookSetting(s.webhook)}}}),e("div",{style:t.styles.dataItem,on:{click:function(e){t.WebHookDialogFormVisible=!0,t.webhook_setting=s}}},[s.webhook.indexOf("dingtalk")>-1?e("i",{staticClass:"iconfont icon-dingtalk",style:t.styles.dataItemImg}):t._e(),s.webhook.indexOf("weixin")>-1?e("i",{staticClass:"iconfont icon-wechat-fill",style:t.styles.dataItemImg}):t._e(),e("div",{style:t.styles.dataItemUnit},[s.webhook.indexOf("dingtalk")>-1?e("div",{style:t.styles.unitAmount},[t._v("钉钉")]):t._e(),s.webhook.indexOf("weixin")>-1?e("div",{style:t.styles.unitAmount},[t._v("企业微信")]):t._e(),e("div",{style:t.styles.unitFooter},[t._v(t._s(s.webhook.split("=")[1].slice(0,8)))]),e("div",{style:t.styles.unitFooter},[t._v("状态："),e("span",{style:s.enabled?"color:#52c41a":"color:#f5222d"},[t._v(t._s(s.enabled?"开启":"关闭")+" ")])])])])])],1)})),e("el-col",{attrs:{xs:24,sm:12,md:12,lg:4,xl:4}},[e("el-card",{attrs:{shadow:"hover"}},[e("div",{style:t.styles.dataItem,on:{click:function(e){t.WebHookDialogFormVisible=!0,t.webhook_setting={}}}},[e("i",{staticClass:"iconfont icon-plus",style:t.styles.dataItemImg}),e("div",{style:t.styles.dataItemUnit},[e("div",{style:t.styles.unitAmountSmall},[t._v("添加钉钉/微信告警")]),e("div",{style:t.styles.unitFooter},[t._v("oapi.dingtalk.com qyapi.weixin.qq.com")])])])])],1)],2),e("el-dialog",{attrs:{title:"SMTP Server",visible:t.MailDialogFormVisible,width:t.mobileClient?"80%":"50%"},on:{"update:visible":function(e){t.MailDialogFormVisible=e}},model:{value:t.MailDialogFormVisible,callback:function(e){t.MailDialogFormVisible=e},expression:"MailDialogFormVisible"}},[e("el-form",{attrs:{model:t.smtp_server}},[e("el-form-item",{attrs:{label:"服务器地址"}},[e("el-input",{attrs:{"auto-complete":"on"},model:{value:t.smtp_server.host,callback:function(e){t.$set(t.smtp_server,"host",e)},expression:"smtp_server.host"}})],1),e("el-form-item",{attrs:{label:"服务器端口"}},[e("el-input-number",{attrs:{size:"small","controls-position":"right",max:65535,min:1,step:1},model:{value:t.smtp_server.port,callback:function(e){t.$set(t.smtp_server,"port",e)},expression:"smtp_server.port"}})],1),e("el-form-item",{attrs:{label:"发件人"}},[e("el-input",{attrs:{"auto-complete":"off"},model:{value:t.smtp_server.from,callback:function(e){t.$set(t.smtp_server,"from",e)},expression:"smtp_server.from"}})],1),e("el-form-item",{attrs:{label:"TLS加密"}},[e("el-switch",{attrs:{"active-color":"#13ce66","inactive-color":"#ff4949"},model:{value:t.smtp_server.tls,callback:function(e){t.$set(t.smtp_server,"tls",e)},expression:"smtp_server.tls"}})],1),e("el-form-item",{attrs:{label:"用户名"}},[e("el-input",{attrs:{"auto-complete":"off"},model:{value:t.smtp_server.username,callback:function(e){t.$set(t.smtp_server,"username",e)},expression:"smtp_server.username"}})],1),e("el-form-item",{attrs:{label:"密码"}},[e("el-input",{attrs:{"auto-complete":"off",type:"password"},model:{value:t.smtp_server.password,callback:function(e){t.$set(t.smtp_server,"password",e)},expression:"smtp_server.password"}})],1),e("el-form-item",{attrs:{label:"监控平台地址"}},[e("el-input",{attrs:{placeholder:t.origin},model:{value:t.smtp_server.domain,callback:function(e){t.$set(t.smtp_server,"domain",e)},expression:"smtp_server.domain"}})],1),e("el-form-item",{attrs:{label:"开启通知"}},[e("el-switch",{attrs:{"active-color":"#13ce66","inactive-color":"#ff4949"},model:{value:t.smtp_server.enabled,callback:function(e){t.$set(t.smtp_server,"enabled",e)},expression:"smtp_server.enabled"}})],1)],1),e("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{attrs:{size:"mini",round:""},on:{click:function(e){t.MailDialogFormVisible=!1}}},[t._v("取 消")]),e("el-button",{attrs:{size:"mini",type:"primary",round:""},on:{click:t.setSMTPServer}},[t._v("确 定")])],1)],1),e("el-dialog",{attrs:{visible:t.WebHookDialogFormVisible,width:t.mobileClient?"80%":"50%"},on:{"update:visible":function(e){t.WebHookDialogFormVisible=e}},model:{value:t.WebHookDialogFormVisible,callback:function(e){t.WebHookDialogFormVisible=e},expression:"WebHookDialogFormVisible"}},[e("div",{style:t.styles.unitAmountSmall,attrs:{slot:"title"},slot:"title"},[t._v(" webhook 配置 目前支持 钉钉/企业微信 ")]),e("el-form",{attrs:{model:t.webhook_setting}},[e("el-form-item",{attrs:{label:"webhook"}},[e("el-input",{attrs:{placeholder:"https://oapi.dingtalk.com/robot/send?access_token=xxx 或 https://qyapi.weixin.qq.com/cgi-bin/webhook/send?key=xxx"},model:{value:t.webhook_setting.webhook,callback:function(e){t.$set(t.webhook_setting,"webhook",e)},expression:"webhook_setting.webhook"}})],1),e("el-form-item",{attrs:{label:"监控平台地址"}},[e("el-input",{attrs:{placeholder:t.origin},model:{value:t.webhook_setting.domain,callback:function(e){t.$set(t.webhook_setting,"domain",e)},expression:"webhook_setting.domain"}})],1),e("el-form-item",{attrs:{label:"开启通知"}},[e("el-switch",{attrs:{"active-color":"#13ce66","inactive-color":"#ff4949"},model:{value:t.webhook_setting.enabled,callback:function(e){t.$set(t.webhook_setting,"enabled",e)},expression:"webhook_setting.enabled"}})],1),e("el-form-item",{attrs:{label:"测试"}},[e("el-button",{attrs:{size:"mini",round:"",disabled:!t.webhook_setting.hasOwnProperty("webhook")},on:{click:t.testWebHookSetting}},[t._v("发送一条测试消息 ")])],1)],1),e("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{attrs:{size:"mini",round:""},on:{click:function(e){t.WebHookDialogFormVisible=!1}}},[t._v("取 消")]),e("el-button",{attrs:{size:"mini",type:"primary",round:""},on:{click:t.setWebHookSetting}},[t._v("确 定")])],1)],1),t.smtp_server.enabled?e("div",[e("el-input",{staticClass:"input-new-mail",attrs:{size:"mini",placeholder:"邮箱格式：username@domain.com"},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.handleInputNoticeConfirm.apply(null,arguments)}},model:{value:t.inputValue,callback:function(e){t.inputValue=e},expression:"inputValue"}}),e("el-button",{attrs:{size:"mini",type:"primary"},on:{click:t.handleInputNoticeConfirm}},[t._v("添加")]),e("el-table",{staticStyle:{width:"100%"},attrs:{stripe:"","tooltip-effect":"dark",data:t.mails}},[e("el-table-column",{attrs:{prop:"mail",label:"邮箱"}}),e("el-table-column",{attrs:{label:"操作"},scopedSlots:t._u([{key:"default",fn:function(s){return[e("el-button",{attrs:{size:"mini",type:"danger",round:""},on:{click:function(e){return t.handleDeleteNotice(s.row)}}},[t._v("删除 ")])]}}],null,!1,3058674270)})],1)],1):t._e()],1)},o=[];const l={dataItem:{display:"flex",flexBasis:"50%",alignItems:"center"},dataItemImg:{color:"#1890ff",width:"30px",marginTop:"auto",marginBottom:"auto",fontSize:"50px",marginRight:"30px"},dataItemUnit:{height:"50px",display:"flex",flexBasis:"50%",flexDirection:"column",justifyContent:"space-between"},unitTitle:{color:"#666",fontSize:"12px"},unitAmount:{color:"#333",fontSize:"24px"},unitAmountSmall:{color:"#999",fontSize:"14px"},unitFooter:{color:"#999",fontSize:"12px"}};var a={data(){return{styles:l,origin:window.location.origin,inputValue:"",popoverVisible:!1,MailDialogFormVisible:!1,WebHookDialogFormVisible:!1,mails:[],formLabelWidth:"200",smtp_server:{},webhook_setting:{domain:window.location.origin},webhooks:[]}},computed:{mobileClient(){return document.documentElement.clientWidth<document.documentElement.clientHeight}},methods:{handleInputNoticeConfirm(){this.inputValue&&this.axios.post(this.api.settingNotice,{mail:this.inputValue}).then((t=>{this.$message.success(t.data.msg),this.mails=t.data.result})).catch((t=>{this.$message.error(t.toString())})),this.inputValue=""},handleDeleteNotice(t){this.axios.delete(this.api.settingNotice,{params:{mail:t.mail}}).then((t=>{this.$message.success(t.data.msg),this.mails=t.data.result})).catch((t=>{this.$message.error(t.toString())}))},fetchNoticeMails(){this.axios.get(this.api.settingNotice).then((t=>{this.mails=t.data.result})).catch((t=>{this.$message.error(t.toString())}))},getSMTPServer(){this.axios.get(this.api.settingMail).then((t=>{t.data.result&&(this.smtp_server=t.data.result)})).catch((t=>{this.$message.error(t.toString())}))},getWebHookSetting(){this.axios.get(this.api.settingWebHook).then((t=>{this.webhooks=t.data.result})).catch((t=>{this.$message.error(t.toString())}))},delWebHookSetting(t){this.axios.delete(this.api.settingWebHook,{params:{webhook:t}}).then((t=>{404===t.data.status?this.$message.error(t.data.msg):(this.$message.success(t.data.msg),this.getWebHookSetting())})).catch((t=>{this.$message.error(t.toString())}))},setWebHookSetting(){this.axios.post(this.api.settingWebHook,this.webhook_setting).then((t=>{400===t.data.status?this.$message.error(t.data.msg):(this.$message.success(t.data.msg),this.WebHookDialogFormVisible=!1,this.getWebHookSetting())})).catch((t=>{this.$message.error(t.toString())}))},testWebHookSetting(){this.webhook_setting.test=!0,this.axios.post(this.api.settingWebHook,this.webhook_setting).then((t=>{201===t.data.status?this.$message.success(t.data.msg):this.$message.error(t.data.msg),this.webhook_setting.test=!1})).catch((t=>{this.$message.error(t.toString()),this.webhook_setting.test=!1}))},setSMTPServer(){this.axios.post(this.api.settingMail,this.smtp_server).then((t=>{this.$message.success(t.data.msg),this.MailDialogFormVisible=!1})).catch((t=>{this.$message.error(t.toString())}))}},mounted:function(){this.getWebHookSetting(),this.getSMTPServer(),this.fetchNoticeMails()}},n=a,r=s(1001),m=(0,r.Z)(n,i,o,!1,null,"0e42e278",null),c=m.exports}}]);
//# sourceMappingURL=964.5b9adc11.js.map